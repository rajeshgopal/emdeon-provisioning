---
classes:
  - role::galera

consul::config_hash:
  data_dir: "/opt/consul"
  datacenter: "east-aws"
  log_level: "INFO"
  node_name: "%{::hostname}"
  bind_addr: "%{::ipaddress_eth0}"
  server: "false"
  start_join: "%{hiera('join_addr')}"

consul::services:
  service1:
    address: "%{::ipaddress}"
    checks:
      - http: http://localhost:42/status
        interval: 5s
    port: 42
    tags:
      - "galera-%{init_role}"
